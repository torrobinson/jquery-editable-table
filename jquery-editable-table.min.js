$.fn.editableTable=function(t){let e;t=$.extend({},{cloneProperties:["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right","color","background-color","border-radius"],columns:[]},t);let n,r="error",i=37,o=38,d=39,a=40,l=$(this);l.find("th").show(),t.columns.forEach((t,e)=>{void 0!==t.isHidden&&t.isHidden&&l.find("th").eq(e).hide()});let s,c=l.parent().find("input[table-editor-input]");function f(e){if((s=l.find("td:focus")).length){let i=$(s).parent().children("td").index($(s)),o=t.columns[i];n.val(s.text()).removeClass(r).show().offset(s.offset()).css(s.css(t.cloneProperties)).width(s.width()).height(s.height()).focus(),void 0!==o.maxLength?n.attr("maxlength",o.maxLength):n.removeAttr("maxlength"),e&&n.select()}}function h(){let t,e=n.val(),i=$.Event("change");if(s.text()===e||n.hasClass(r))return!0;t=s.html(),s.text(e).trigger(i,e),!1===i.result&&s.html(t)}function u(t,e){return e===d?t.next("td"):e===i?t.prev("td"):e===o?t.parent().prev().children().eq(t.index()):e===a?t.parent().next().children().eq(t.index()):[]}return(n=c.length?c.first():$("<input>")).attr("table-editor-input","").css("position","absolute").hide().appendTo(l.parent()),n.blur(function(){h(),n.hide()}),n.keydown(function(t){if(13===t.which)h(),n.hide(),s.focus(),t.preventDefault(),t.stopPropagation();else if(27===t.which)n.val(s.text()),t.preventDefault(),t.stopPropagation(),n.hide(),s.focus();else if(9===t.which)s.focus();else if(this.selectionEnd-this.selectionStart===this.value.length){let e=u(s,t.which);e.length>0&&(e.focus(),t.preventDefault(),t.stopPropagation())}}),n.on("input paste",function(){let t=$.Event("validate");s.trigger(t,n.val()),void 0!==t.result&&(!1===t.result?n.addClass(r):n.removeClass(r))}),l.on("click keypress dblclick",f).css("cursor","pointer").keydown(function(t){let e=!0,n=u($(t.target),t.which);n.length>0?n.focus():13===t.which?f(!1):17===t.which||91===t.which||93===t.which?(f(!0),e=!1):e=!1,e&&(t.stopPropagation(),t.preventDefault())}),l.find("td").prop("tabindex",1),$(window).on("resize",function(){n.is(":visible")&&n.offset(s.offset()).width(s.width()).height(s.height())}),$("table td").on("validate",function(n,r){let i=$(n.currentTarget).parent().children("td").index($(n.currentTarget)),o=t.columns[i],d=e.getData({convert:!1});return o.isValid&&o.isValid(r,d)}),$("table td").on("change",function(e,n){let r=$(this),i=$(e.currentTarget).parent().children("td").index($(e.currentTarget)),o=t.columns[i];return o.removeRowIfCleared&&""==n&&r.parent("tr").remove(),"function"==typeof o.afterChange&&o.afterChange(n,r),!0}),e={getData:function(e){e=$.extend({},{convert:!0},e);let n=[];return l.find("tbody tr").toArray().forEach(r=>{let i={};$(r).find("td").toArray().forEach(n=>{let r=t.columns[$(n).parent().children("td").index($(n))],o=$(n).text(),d=$(n).attr("data-is-null");void 0!==d&&!1!==d&&(o=null),e.convert&&"function"==typeof r.convertOut&&(o=r.convertOut(o)),i[r.name]=o}),n.push(i)}),n},addRow:function(e){let n=$("<tr></tr>");if(null!=e){let r=Object.keys(e),i=[];r.forEach(n=>{let r=t.columns.filter(t=>t.name===n);r.length&&(r=r[0],i.push({order:r.index,value:e[n],prop:n,def:r}))}),i.sort((t,e)=>t.order-e.order).forEach((e,r)=>{let i;i=null!==e.value?$(`<td>${e.value}</td>`):$("<td data-is-null></td>"),void 0!==e.def.classes&&e.def.classes.length&&e.def.classes.forEach(t=>i.addClass(t)),void 0!==e.def.style&&e.def.style.length&&i.attr("style",i.attr("style")+"; "+e.def.style),void 0!==e.def.isHidden&&e.def.isHidden&&i.hide(),n.append(i);let o=t.columns.filter(t=>t.name===e.prop)[0];"function"==typeof o.afterAdd&&o.afterAdd(e.value,i)})}else n=$("<tr></tr>"),activeOptions.columns.forEach(t=>{n.append("<td></td>")});let r=l.find("tbody tr:last");r.length>0?r.after(n):l.find("tbody").append(n),$(l).editableTable(t)},clear:function(){l.find("tbody tr").remove()},setData:function(t){t&&(this.clear(),t.forEach(t=>{this.addRow(t)}))}}};